<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Times Table Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            transition: background-color 0.5s linear;
        }
    </style>
</head>
<body class="bg-gray-800 text-white flex flex-col items-center justify-center min-h-screen font-sans transition-colors duration-1000" id="main-body">

    <!-- Start Screen -->
    <div id="start-screen" class="text-center">
        <h1 class="text-5xl font-bold mb-4">Times Table Challenge</h1>
        <p class="text-xl mb-8">Choose your challenge:</p>
        <div id="table-selection" class="grid grid-cols-3 gap-4">
            <!-- Buttons will be generated by JavaScript -->
        </div>
    </div>

    <!-- Difficulty Screen -->
    <div id="difficulty-screen" class="hidden text-center w-full max-w-md">
        <h2 class="text-4xl font-bold mb-4">Select Difficulty</h2>
        <div class="bg-gray-700 p-6 rounded-lg">
            <p id="difficulty-label" class="text-3xl font-bold mb-4"><span id="difficulty-emoji" class="mr-4"></span></p>
            <input type="range" id="difficulty-slider" min="0" max="3" value="1" class="w-full h-3 bg-gray-500 rounded-lg appearance-none cursor-pointer">
        </div>
        <button id="start-challenge-btn" class="mt-8 bg-green-500 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg text-2xl">Start Challenge</button>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="hidden w-full max-w-md text-center">
        <p id="mode-display" class="text-xl mb-2 font-semibold"></p>
        <div id="timer-container" class="mb-4">
            <p id="timer-text" class="text-3xl font-mono"></p>
        </div>
        <div id="question-container" class="mb-8">
            <p id="question-text" class="text-6xl font-bold"></p>
        </div>
        <div id="answer-container" class="relative mb-8">
            <input type="text" id="answer-input" class="bg-gray-700 text-white text-4xl w-full text-center rounded-lg py-2" readonly>
            <span id="timeout-emoji" class="absolute right-4 top-1/2 -translate-y-1/2 text-4xl hidden">üòû</span>
        </div>
        <div id="numpad" class="grid grid-cols-3 gap-4">
            <!-- Numpad buttons will be generated by JavaScript -->
        </div>
    </div>

    <!-- Score Screen -->
    <div id="score-screen" class="hidden text-center">
        <h2 class="text-4xl font-bold mb-4">Game Over!</h2>
        <p id="final-score" class="text-3xl mb-8"></p>
        <p id="score-message" class="text-xl mb-8"></p>
        <button id="play-again-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg text-2xl">Play Again</button>
    </div>

    <!-- Trophy Room -->
    <div id="trophy-room" class="w-full max-w-md mt-8 text-center md:absolute md:w-auto md:max-w-none md:bottom-4 md:right-4 md:text-right">
        <h3 class="text-2xl font-bold mb-2">üèÜ Trophy Room</h3>
        <div id="trophies" class="flex flex-col items-end space-y-2">
            <!-- Trophies will be generated by JavaScript -->
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
          const mainBody = document.getElementById("main-body");
          const startScreen = document.getElementById("start-screen");
          const tableSelection = document.getElementById("table-selection");
          const gameScreen = document.getElementById("game-screen");
          const questionText = document.getElementById("question-text");
          const answerInput = document.getElementById("answer-input");
          const timerText = document.getElementById("timer-text");
          const timeoutEmoji = document.getElementById("timeout-emoji");
          const numpad = document.getElementById("numpad");
          const scoreScreen = document.getElementById("score-screen");
          const finalScore = document.getElementById("final-score");
          const scoreMessage = document.getElementById("score-message");
          const playAgainBtn = document.getElementById("play-again-btn");
          const trophyRoom = document.getElementById("trophy-room");
          const trophies = document.getElementById("trophies");
          const difficultyScreen = document.getElementById("difficulty-screen");
          const difficultyLabel = document.getElementById("difficulty-label");
          const difficultyEmoji = document.getElementById("difficulty-emoji");
          const difficultySlider = document.getElementById("difficulty-slider");
          const startChallengeBtn = document.getElementById("start-challenge-btn");
          const modeDisplay = document.getElementById("mode-display");

          const ACHIEVEMENT_TITLES = {
            2: "Double Dragon Slayer",
            3: "Triple Superhero",
            4: "Four-Force Warrior",
            5: "Five-Star Champion",
            6: "Six-Pack Ninja",
            7: "Seven Seas Explorer",
            8: "Eight-Bit Master",
            9: "Nine Lives Cat",
            10: "Perfect Ten Hero",
          };

          const DIFFICULTY_LEVELS = [
            { name: "Chill Mode", time: 15, emoji: "üòé" },
            { name: "Beast Mode", time: 9, emoji: "üëπ" },
            { name: "Insane Legend", time: 6, emoji: "üë∫" },
            { name: "Supersonic Hamster", time: 3, emoji: "üêπ" },
          ];

          let currentTable;
          let questions = [];
          let currentQuestionIndex = 0;
          let score = 0;
          let timerInterval;
          let timeLimit = 9; // Default time limit

          function init() {
            showStartScreen();
            createTableSelectionButtons();
            createNumpad();
            loadTrophies();
            playAgainBtn.addEventListener("click", showStartScreen);
            difficultySlider.addEventListener("input", updateDifficultyLabel);
            startChallengeBtn.addEventListener("click", startGame);
            updateDifficultyLabel(); // Initial label update
          }

          function updateDifficultyLabel() {
            const level = DIFFICULTY_LEVELS[difficultySlider.value];
            difficultyEmoji.textContent = `${level.name} (${level.time}s) ${level.emoji}`;
            difficultyLabel.childNodes[1].nodeValue = ` ${level.name} (${level.time}s)`;
          }

          function createTableSelectionButtons() {
            tableSelection.innerHTML = ""; // Clear previous buttons
            for (let i = 2; i <= 10; i++) {
              const button = document.createElement("button");
              button.textContent = `${i} Times Table`;
              button.className =
                "bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg text-lg border-b-4 border-indigo-700 active:border-b-0 transform active:translate-y-1 transition-all duration-100";
              button.onclick = () => selectDifficulty(i);
              tableSelection.appendChild(button);
            }
          }

          function createNumpad() {
            numpad.innerHTML = ""; // Clear previous buttons
            const buttons = [
              "1",
              "2",
              "3",
              "4",
              "5",
              "6",
              "7",
              "8",
              "9",
              "Clear",
              "0",
              "Enter",
            ];
            buttons.forEach((label) => {
              const button = document.createElement("button");
              button.textContent = label;
              button.className =
                "bg-gray-600 hover:bg-gray-700 text-white font-bold py-4 rounded-lg text-3xl border-b-4 border-gray-800 active:border-b-0 transform active:translate-y-1 transition-all duration-100";

              if (label === "Clear") {
                button.onclick = () => (answerInput.value = "");
              } else if (label === "Enter") {
                button.onclick = () => nextQuestion();
              } else {
                button.onclick = () => (answerInput.value += label);
              }
              numpad.appendChild(button);
            });
          }

          function selectDifficulty(table) {
            currentTable = table;
            showDifficultyScreen();
          }

          function startGame() {
            const level = DIFFICULTY_LEVELS[difficultySlider.value];
            timeLimit = level.time;

            // Set mode display text
            modeDisplay.textContent = `Mode: ${level.name} ${level.emoji}`;

            currentQuestionIndex = 0;
            score = 0;
            generateQuestions();
            showGameScreen();
            displayNextQuestion();
          }

          function generateQuestions() {
            questions = [];
            for (let i = 1; i <= 12; i++) {
              questions.push({
                question: `${currentTable} x ${i}`,
                answer: currentTable * i,
              });
            }
            // Shuffle questions
            questions.sort(() => Math.random() - 0.5);
          }

          function displayNextQuestion() {
            if (currentQuestionIndex < questions.length) {
              const question = questions[currentQuestionIndex];
              questionText.textContent = question.question;
              answerInput.value = "";
              timeoutEmoji.classList.add("hidden");
              resetTimer();
            } else {
              endGame();
            }
          }

          function resetTimer() {
            clearInterval(timerInterval);
            let timeLeft = timeLimit;
            timerText.textContent = timeLeft.toFixed(1);

            timerInterval = setInterval(() => {
              timeLeft -= 0.1;
              timerText.textContent = timeLeft.toFixed(1);
              updateBackgroundColor(timeLeft);
              if (timeLeft <= 0) {
                clearInterval(timerInterval);
                timeoutEmoji.classList.remove("hidden");
                setTimeout(() => {
                  nextQuestion();
                }, 500); // Wait half a second before next question
              }
            }, 100);
          }

          function updateBackgroundColor(timeLeft) {
            const progress = (timeLimit - timeLeft) / timeLimit;
            const blue = [66, 135, 245]; // RGB for blue
            const red = [237, 67, 55]; // RGB for red
            const color = blue.map((start, i) => {
              return Math.round(start + progress * (red[i] - start));
            });
            mainBody.style.backgroundColor = `rgb(${color[0]}, ${color[1]}, ${color[2]})`;
          }

          function nextQuestion() {
            clearInterval(timerInterval);
            checkAnswer();
            currentQuestionIndex++;
            displayNextQuestion();
          }

          function checkAnswer() {
            const userAnswer = parseInt(answerInput.value, 10);
            if (userAnswer === questions[currentQuestionIndex].answer) {
              score++;
            }
          }

          function endGame() {
            showScoreScreen();
            finalScore.textContent = `You scored ${score} out of ${questions.length}`;
            if (score === questions.length) {
              const levelIndex = difficultySlider.value;
              scoreMessage.textContent = `Perfect! You've mastered the ${currentTable} times table!`;
              addTrophy(currentTable, levelIndex);
            } else {
              scoreMessage.textContent = "Keep practicing to get a perfect score!";
            }
          }

          function addTrophy(table, levelIndex) {
            const trophyKey = `trophy-table-${table}-level-${levelIndex}`;
            if (!localStorage.getItem(trophyKey)) {
              localStorage.setItem(trophyKey, "true");
              loadTrophies();
            }
          }

          function loadTrophies() {
            trophies.innerHTML = "";
            for (let i = 2; i <= 10; i++) {
              for (let j = 0; j < DIFFICULTY_LEVELS.length; j++) {
                if (localStorage.getItem(`trophy-table-${i}-level-${j}`)) {
                  const level = DIFFICULTY_LEVELS[j];
                  const trophy = document.createElement("div");
                  trophy.textContent = `${ACHIEVEMENT_TITLES[i]} ${level.emoji}`;
                  trophy.className =
                    "bg-yellow-500 text-gray-800 font-bold p-2 rounded";
                  trophies.appendChild(trophy);
                }
              }
            }
          }

          function showStartScreen() {
            startScreen.classList.remove("hidden");
            difficultyScreen.classList.add("hidden");
            gameScreen.classList.add("hidden");
            scoreScreen.classList.add("hidden");
            mainBody.style.backgroundColor = ""; // Reset to default
            mainBody.classList.add("bg-gray-800");
          }

          function showDifficultyScreen() {
            startScreen.classList.add("hidden");
            difficultyScreen.classList.remove("hidden");
            gameScreen.classList.add("hidden");
            scoreScreen.classList.add("hidden");
          }

          function showGameScreen() {
            difficultyScreen.classList.add("hidden");
            gameScreen.classList.remove("hidden");
            scoreScreen.classList.add("hidden");
            mainBody.classList.remove("bg-gray-800");
          }

          function showScoreScreen() {
            gameScreen.classList.add("hidden");
            scoreScreen.classList.remove("hidden");
          }

          init();
        });
    </script>
</body>
</html>
